<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/global.css" />
    <link rel="stylesheet" href="/css/navbar.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/list.css" />
    <title><%= title %></title>
  </head>
  <body>
    <main>
      <nav class="navbar">
        <div class="navbar__container">
          <a href="/" class="page-link">Home</a>
          <a href="#" class="page-link">Listar</a>
          <a href="" class="page-link">Sobre</a>
        </div>
      </nav>
      <div class="content">
        <section>
          <table class="expense-table">
            <thead>
              <tr>
                <th>Titulo</th>
                <th>Data</th>
                <th>Remover</th>
                <th>Editar</th>
              </tr>
            </thead>
            <tbody>
              <% for( let expense of expenses) {%>
              <tr>
                <td class="expense-title">
                  <div class="title"><%= expense.title %></div>
                  <span class="icon">
                    <ion-icon name="arrow-dropup"></ion-icon>
                  </span>
                  <span class="icon">
                    <ion-icon name="arrow-dropdown"></ion-icon>
                  </span>
                </td>
                <td class="expense-date"><%= expense.date %></td>
                <td class="expense-trash">
                  <ion-icon name="trash" data-id="<%= expense.id %>"></ion-icon>
                </td>
                <td class="expense-edit">
                  <ion-icon
                    name="create"
                    data-id="<%= expense.id %>"
                  ></ion-icon>
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </section>
      </div>
      <footer class="footer">
        <div class="footer__container">
          <h1><%= title %> &copy 2021</h1>
        </div>
      </footer>
      <script defer type="text/javascript">
        const trashArrayBtn = document.querySelectorAll(
          '.expense-trash [name="trash"]'
        );
        const editArrayBtn = document.querySelectorAll(
          '.expense-edit [name="create"]'
        );
        trashArrayBtn.forEach((trashBtn) => {
          trashBtn.addEventListener("click", async () => {
            console.log("asasasasas");
            const response = await fetch("/expense/remove", {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
                Accept: "application/json",
              },
              body: JSON.stringify({
                id: trashBtn.dataset.id,
              }),
            });
            const json = await response.json();
            if (json.ok) {
              console.log("Success:", json);
              trashBtn.parentNode.parentNode.remove();
            } else {
              console.error("Error:", json);
            }
          });
        });
        editArrayBtn.forEach((editBtn) => {
          editBtn.addEventListener("click", () => {
            location.href = "/expense/edit-expense-list/" + editBtn.dataset.id;
          });
        });
      </script>
      <script
        type="module"
        src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
      ></script>
      <script
        nomodule
        src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
      ></script>
    </main>
  </body>
</html>
